{"ast":null,"code":"import _regeneratorRuntime from\"/Users/jay_lohokare/Desktop/PPL Codes/webgl-3d-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/jay_lohokare/Desktop/PPL Codes/webgl-3d-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/jay_lohokare/Desktop/PPL Codes/webgl-3d-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/jay_lohokare/Desktop/PPL Codes/webgl-3d-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/jay_lohokare/Desktop/PPL Codes/webgl-3d-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/jay_lohokare/Desktop/PPL Codes/webgl-3d-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import DataView from\"./dataView\";import{OBJLoader}from\"@loaders.gl/obj\";import{registerLoaders}from\"@loaders.gl/core\";import Materialize from\"materialize-css\";import{SimpleMeshLayer}from\"@deck.gl/mesh-layers\";import{PathLayer}from\"@deck.gl/layers\";import{COORDINATE_SYSTEM,MapView}from\"@deck.gl/core\";import{DirectionalLight,LightingEffect,PointLight,AmbientLight,_CameraLight as CameraLight}from\"@deck.gl/core\";import{PathStyleExtension}from\"@deck.gl/extensions\";import{DeckGL}from\"@deck.gl/react\";import{StaticMap}from\"react-map-gl\";import{inject,observer}from\"mobx-react\";import{toJS}from\"mobx\";import ControlPanel from\"./control-panel\";import RefreshButton from\"../Components/RefreshButton\";import LayersButton from\"../Components/LayersButton\";import StreetViewModeButton from\"../Components/StreetViewModeButton\";registerLoaders([OBJLoader]);var accessToken=\"pk.eyJ1IjoiamF5bG9ob2thcmUiLCJhIjoiY2tkcnI4OHU3MGZ6NDJ0bHFsOHRrcTljeiJ9.D9GoLNq2BgK16q5w3TjJ1g\";var modelFilesURL=\"models/\";// \"https://pplz-fun-3dviewer-d.pplz-iase-1d.appserviceenvironment.net/api/modelfiles/?code=P6HoAEt3ooe/NqpB/Fek4Po1Kqx/a4KsL98Qu1/EI0FPjDYXW2fCzQ==&model_name=\";\nvar WebglView=/*#__PURE__*/function(_Component){_inherits(WebglView,_Component);var _super=_createSuper(WebglView);function WebglView(){var _this;_classCallCheck(this,WebglView);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={model:_this.props.model,mapStyle:\"\",modelLayersList:[],connectivityLayersList:[],showConnectivity:false,showModels:true,time:0};_this.refreshAssets=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(_this.props.store.mapViewPort.zoom<12){Materialize.toast({html:\"Please zoom in more to load assets\",displayLength:2000,classes:\"rounded\"});}_this.props.store.getModelList();_this.props.store.refeshConnectivityLayer();case 3:case\"end\":return _context.stop();}}},_callee);}));_this.toggleStreetView=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_this.props.store.toggleStreetViewMode();case 1:case\"end\":return _context2.stop();}}},_callee2);}));_this._onStyleChange=function(mapStyle){return _this.setState({mapStyle:mapStyle});};_this.layerCheck=function(name,isChecked){if(name===\"models\"){_this.setState({showModels:isChecked});}else if(name===\"connectivity\"){_this.setState({showConnectivity:isChecked});}};return _this;}_createClass(WebglView,[{key:\"_renderEffects\",value:function _renderEffects(){var effectsToRender=[];var ambientLight=new AmbientLight({color:[255,255,255],intensity:1});effectsToRender.push(ambientLight);if(this.props.store.assets.toString()!=\"\"&&this.props.store.assets!=[]){this.props.store.assets.map(function(model){try{if(model){var light1=new PointLight({color:[255,255,255],intensity:2,position:[model.geometry.X,model.geometry.Y,400]});effectsToRender.push(light1);var light2=new PointLight({color:[255,255,255],intensity:2,position:[model.geometry.X-20,model.geometry.Y-20,400]});effectsToRender.push(light2);var light3=new PointLight({color:[255,255,255],intensity:2,position:[model.geometry.X+20,model.geometry.Y+20,400]});effectsToRender.push(light3);var light4=new PointLight({color:[255,255,255],intensity:2,position:[model.geometry.X+20,model.geometry.Y-20,400]});effectsToRender.push(light4);var light5=new PointLight({color:[255,255,255],intensity:2,position:[model.geometry.X-20,model.geometry.Y+20,400]});effectsToRender.push(5);}}catch(_unused){}});}var effects=new LightingEffect(effectsToRender);return[effects];}},{key:\"_renderLayers\",value:function _renderLayers(){var _this2=this;var LayersList=[];var meshLayerMat={};meshLayerMat.ambient=1;meshLayerMat.diffuse=0.2;meshLayerMat.shininess=0;if(this.props.store.assets.toString()!=\"\"&&this.props.store.assets!=[]){this.props.store.assets.map(function(model){if(model){//DO NOT DELETE THIS LOG STATEMENT\nconsole.log(model.geometry.ModelName,model.Equipement,model.AssetId);try{var layer=new SimpleMeshLayer({id:\"models_\".concat(model.AssetId),data:[{position:[model.geometry.X,model.geometry.Y,model.geometry.Z],zoom:18,orientation:[model.geometry.RotationX,model.geometry.RotationY,model.geometry.RotationZ],model:model}],mesh:modelFilesURL+model.geometry.ModelName+\".obj\",material:meshLayerMat,sizeScale:model.geometry.Scale,visible:_this2.state.showModels?true:false,coordinateSystem:COORDINATE_SYSTEM.LNGLAT,getPosition:function getPosition(d){return d.position;},getOrientation:function getOrientation(d){return d.orientation;},pickable:true,onClick:function onClick(event){_this2.props.store.setDataPanelModel(event.object.model);}});LayersList.push(layer);}catch(_unused2){}}});}// eslint-disable-next-line\ntoJS(this.props.store.subNetConectivity).map(function(x,i){var staticPathLayerSubNet=new PathLayer({id:\"\".concat(i,\"-subnet-connectivity\"),data:x,pickable:false,visible:_this2.state.showConnectivity?true:false,widthMinPixels:2,opacity:0.6,getPath:function getPath(d){return d;},positionFormat:'XYZ',getColor:[253,128,93],getWidth:function getWidth(d){return 1;}});LayersList.push(staticPathLayerSubNet);});// eslint-disable-next-line\ntoJS(this.props.store.stagedConnectivityData).map(function(x,i){var staticPathLayerSubNetStaged=new PathLayer({id:\"\".concat(i,\"-subnet-connectivity-staged\"),data:x,pickable:false,visible:_this2.state.showConnectivity?true:false,widthMinPixels:2,opacity:0.76,getPath:function getPath(d){return d;},positionFormat:'XYZ',getColor:[246,0,0],getWidth:function getWidth(d){return 1;},getDashArray:[2,3],dashJustified:true,extensions:[new PathStyleExtension({dash:true})]});LayersList.push(staticPathLayerSubNetStaged);});return[LayersList];}},{key:\"render\",value:function render(){var _this3=this;return/*#__PURE__*/React.createElement(\"div\",{className:\"mapContainer\"},/*#__PURE__*/React.createElement(DeckGL,{initialViewState:this.props.store.mapViewPort,controller:true,onViewStateChange:function onViewStateChange(_ref3){var viewState=_ref3.viewState;return _this3.props.store.updateMapViewport(viewState);},effects:this._renderEffects(),layers:this._renderLayers()},/*#__PURE__*/React.createElement(MapView,{id:\"mapView\",controller:true},/*#__PURE__*/React.createElement(StaticMap,{mapboxApiAccessToken:accessToken,mapStyle:this.state.mapStyle})),/*#__PURE__*/React.createElement(ControlPanel,{setMapStyle:this._onStyleChange,additionalLayers:this.state.layersList,toggleParent:this.layerCheck})),/*#__PURE__*/React.createElement(RefreshButton,{refreshClick:this.refreshAssets}),/*#__PURE__*/React.createElement(LayersButton,null),/*#__PURE__*/React.createElement(StreetViewModeButton,{toggleStreetView:this.toggleStreetView}),/*#__PURE__*/React.createElement(DataView,null));}}]);return WebglView;}(Component);export default inject(\"store\")(observer(WebglView));","map":{"version":3,"sources":["/Users/jay_lohokare/Desktop/PPL Codes/webgl-3d-web/src/webGL/mapView.js"],"names":["React","Component","DataView","OBJLoader","registerLoaders","Materialize","SimpleMeshLayer","PathLayer","COORDINATE_SYSTEM","MapView","DirectionalLight","LightingEffect","PointLight","AmbientLight","_CameraLight","CameraLight","PathStyleExtension","DeckGL","StaticMap","inject","observer","toJS","ControlPanel","RefreshButton","LayersButton","StreetViewModeButton","accessToken","modelFilesURL","WebglView","state","model","props","mapStyle","modelLayersList","connectivityLayersList","showConnectivity","showModels","time","refreshAssets","store","mapViewPort","zoom","toast","html","displayLength","classes","getModelList","refeshConnectivityLayer","toggleStreetView","toggleStreetViewMode","_onStyleChange","setState","layerCheck","name","isChecked","effectsToRender","ambientLight","color","intensity","push","assets","toString","map","light1","position","geometry","X","Y","light2","light3","light4","light5","effects","LayersList","meshLayerMat","ambient","diffuse","shininess","console","log","ModelName","Equipement","AssetId","layer","id","data","Z","orientation","RotationX","RotationY","RotationZ","mesh","material","sizeScale","Scale","visible","coordinateSystem","LNGLAT","getPosition","d","getOrientation","pickable","onClick","event","setDataPanelModel","object","subNetConectivity","x","i","staticPathLayerSubNet","widthMinPixels","opacity","getPath","positionFormat","getColor","getWidth","stagedConnectivityData","staticPathLayerSubNetStaged","getDashArray","dashJustified","extensions","dash","viewState","updateMapViewport","_renderEffects","_renderLayers","layersList"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\r\nimport DataView from \"./dataView\";\r\nimport { OBJLoader } from \"@loaders.gl/obj\";\r\nimport { registerLoaders } from \"@loaders.gl/core\";\r\nimport Materialize from \"materialize-css\";\r\nimport { SimpleMeshLayer } from \"@deck.gl/mesh-layers\";\r\nimport { PathLayer } from \"@deck.gl/layers\";\r\nimport { COORDINATE_SYSTEM, MapView } from \"@deck.gl/core\";\r\nimport { DirectionalLight, LightingEffect, PointLight, AmbientLight, _CameraLight as CameraLight } from \"@deck.gl/core\";\r\nimport { PathStyleExtension } from \"@deck.gl/extensions\";\r\nimport { DeckGL } from \"@deck.gl/react\";\r\nimport { StaticMap } from \"react-map-gl\";\r\nimport { inject, observer } from \"mobx-react\";\r\nimport { toJS } from \"mobx\";\r\nimport ControlPanel from \"./control-panel\";\r\nimport RefreshButton from \"../Components/RefreshButton\";\r\nimport LayersButton from \"../Components/LayersButton\";\r\nimport StreetViewModeButton from \"../Components/StreetViewModeButton\";\r\n\r\nregisterLoaders([OBJLoader]);\r\n\r\nconst accessToken =\r\n  \"pk.eyJ1IjoiamF5bG9ob2thcmUiLCJhIjoiY2tkcnI4OHU3MGZ6NDJ0bHFsOHRrcTljeiJ9.D9GoLNq2BgK16q5w3TjJ1g\";\r\n\r\nconst modelFilesURL = \"models/\"\r\n\r\n  // \"https://pplz-fun-3dviewer-d.pplz-iase-1d.appserviceenvironment.net/api/modelfiles/?code=P6HoAEt3ooe/NqpB/Fek4Po1Kqx/a4KsL98Qu1/EI0FPjDYXW2fCzQ==&model_name=\";\r\n\r\nclass WebglView extends Component {\r\n  state = {\r\n      model: this.props.model,\r\n      mapStyle: \"\",\r\n      modelLayersList: [],\r\n      connectivityLayersList: [],\r\n      showConnectivity: false,\r\n      showModels: true,\r\n      time: 0,\r\n    };\r\n\r\n  refreshAssets = async () => {\r\n    if (this.props.store.mapViewPort.zoom < 12) {\r\n      Materialize.toast({\r\n        html: \"Please zoom in more to load assets\",\r\n        displayLength: 2000,\r\n        classes: \"rounded\",\r\n      });\r\n    }\r\n    \r\n      this.props.store.getModelList();\r\n      this.props.store.refeshConnectivityLayer();\r\n    \r\n  };\r\n\r\n  toggleStreetView = async () => {\r\n    this.props.store.toggleStreetViewMode();\r\n  };\r\n\r\n  _onStyleChange = (mapStyle) => this.setState({ mapStyle });\r\n\r\n  layerCheck = (name, isChecked) => {\r\n    if (name === \"models\") {\r\n      this.setState({\r\n        showModels: isChecked,\r\n      });\r\n    } else if (name === \"connectivity\") {\r\n      this.setState({\r\n        showConnectivity: isChecked,\r\n      });\r\n    }\r\n  };\r\n\r\n  _renderEffects() {\r\n\r\n    let effectsToRender = [];\r\n    \r\n    const ambientLight = new AmbientLight({\r\n      color: [255, 255, 255],\r\n      intensity: 1\r\n    });\r\n    effectsToRender.push(ambientLight);\r\n    \r\n    if(this.props.store.assets.toString() != \"\" &&  this.props.store.assets != []){\r\n      this.props.store.assets.map((model) => {\r\n        try{\r\n          if(model){\r\n            const light1 = new PointLight({\r\n              color: [255, 255, 255],\r\n              intensity: 2,\r\n              position: [model.geometry.X, model.geometry.Y, 400]\r\n            });\r\n            effectsToRender.push(light1);\r\n\r\n            const light2 = new PointLight({\r\n              color: [255, 255, 255],\r\n              intensity: 2,\r\n              position: [model.geometry.X-20, model.geometry.Y-20, 400]\r\n            });\r\n            effectsToRender.push(light2);\r\n\r\n            const light3 = new PointLight({\r\n              color: [255, 255, 255],\r\n              intensity: 2,\r\n              position: [model.geometry.X+20, model.geometry.Y+20, 400]\r\n            });\r\n            effectsToRender.push(light3);\r\n\r\n            const light4 = new PointLight({\r\n              color: [255, 255, 255],\r\n              intensity: 2,\r\n              position: [model.geometry.X+20, model.geometry.Y-20, 400]\r\n            });\r\n            effectsToRender.push(light4);\r\n\r\n            const light5 = new PointLight({\r\n              color: [255, 255, 255],\r\n              intensity: 2,\r\n              position: [model.geometry.X-20, model.geometry.Y+20, 400]\r\n            });\r\n            effectsToRender.push(5);\r\n\r\n          }\r\n        }\r\n        catch{}\r\n      });\r\n    }\r\n\r\n    var effects = new LightingEffect(effectsToRender)\r\n    return [effects];\r\n  }\r\n\r\n  _renderLayers() {\r\n    let LayersList = [];\r\n\r\n    const meshLayerMat = {};\r\n    meshLayerMat.ambient = 1;\r\n    meshLayerMat.diffuse = 0.2;\r\n    meshLayerMat.shininess = 0;\r\n\r\n    if(this.props.store.assets.toString() != \"\" &&  this.props.store.assets != []){\r\n      this.props.store.assets.map((model) => {\r\n        if(model){\r\n\r\n          //DO NOT DELETE THIS LOG STATEMENT\r\n          console.log(model.geometry.ModelName, model.Equipement, model.AssetId);\r\n\r\n          try {\r\n            let layer = new SimpleMeshLayer({\r\n              id: `models_${model.AssetId}`,\r\n              data: [\r\n                {\r\n                  position: [model.geometry.X, model.geometry.Y, model.geometry.Z],\r\n                  zoom: 18,\r\n                  orientation: [\r\n                    model.geometry.RotationX,\r\n                    model.geometry.RotationY,\r\n                    model.geometry.RotationZ,\r\n                  ],\r\n                  model: model,\r\n                },\r\n              ],\r\n              mesh: modelFilesURL + model.geometry.ModelName + \".obj\",\r\n              material: meshLayerMat,\r\n              sizeScale: model.geometry.Scale,\r\n              visible: this.state.showModels ? true : false,\r\n              coordinateSystem: COORDINATE_SYSTEM.LNGLAT,\r\n              getPosition: (d) => d.position,\r\n              getOrientation: (d) => d.orientation,\r\n              pickable: true,\r\n              onClick: (event) => {\r\n                this.props.store.setDataPanelModel(event.object.model);\r\n              },\r\n            });\r\n\r\n            LayersList.push(layer);\r\n          } catch {}\r\n        }\r\n      });\r\n    }\r\n    // eslint-disable-next-line\r\n    toJS(this.props.store.subNetConectivity).map((x, i) => {\r\n      const staticPathLayerSubNet = new PathLayer({\r\n        id: `${i}-subnet-connectivity`,\r\n        data: x,\r\n        pickable: false,\r\n        visible: this.state.showConnectivity ? true : false,\r\n        widthMinPixels: 2,\r\n        opacity: 0.6,\r\n        getPath: (d) => d,\r\n        positionFormat: 'XYZ',\r\n        getColor: [253, 128, 93],\r\n        getWidth: (d) => 1,\r\n      });\r\n      LayersList.push(staticPathLayerSubNet);\r\n    });\r\n    \r\n    // eslint-disable-next-line\r\n    toJS(this.props.store.stagedConnectivityData).map((x, i) => {\r\n      const staticPathLayerSubNetStaged = new PathLayer({\r\n        id: `${i}-subnet-connectivity-staged`,\r\n        data: x,\r\n        pickable: false,\r\n        visible: this.state.showConnectivity ? true : false,\r\n        widthMinPixels: 2,\r\n        opacity: 0.76,\r\n        getPath: (d) => d,\r\n        positionFormat: 'XYZ',\r\n        getColor: [246, 0, 0],\r\n        getWidth: (d) => 1,\r\n        getDashArray: [2, 3],\r\n        dashJustified: true,\r\n        extensions: [new PathStyleExtension({ dash: true })],\r\n      });\r\n      LayersList.push(staticPathLayerSubNetStaged);\r\n    });\r\n\r\n    return [LayersList];\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div\r\n      className=\"mapContainer\" >\r\n        <DeckGL\r\n          initialViewState={this.props.store.mapViewPort}\r\n          controller={true}\r\n          onViewStateChange={({ viewState }) =>\r\n            this.props.store.updateMapViewport(viewState)\r\n          }\r\n          effects={this._renderEffects()}\r\n          layers={this._renderLayers()}\r\n        >\r\n\r\n          <MapView \r\n            id=\"mapView\" \r\n            controller={true}>\r\n            <StaticMap\r\n              mapboxApiAccessToken={accessToken}\r\n              mapStyle={this.state.mapStyle}\r\n            />\r\n          </MapView>\r\n\r\n          <ControlPanel\r\n            setMapStyle={this._onStyleChange}\r\n            additionalLayers={this.state.layersList}\r\n            toggleParent={this.layerCheck}\r\n          />\r\n        </DeckGL>\r\n\r\n        <RefreshButton refreshClick={this.refreshAssets} />\r\n        <LayersButton />\r\n        <StreetViewModeButton toggleStreetView={this.toggleStreetView} />\r\n\r\n        <DataView />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default inject(\"store\")(observer(WebglView));\r\n"]},"metadata":{},"sourceType":"module"}